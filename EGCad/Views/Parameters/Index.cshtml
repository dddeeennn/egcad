@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<div class="page-header">
    <h2>Введите параметры</h2>
</div>
<div class="form-group">
    <form class="form-inline" role="form">
        <div class="form-group">
            <input type="text" class="form-control" id="parameterName" placeholder="Название параметра">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" id="parameterUnit" placeholder="Единицы измерения">
        </div>
        <span id="saveParameter" class="btn btn-default">Добавить</span>
    </form>
</div>
<div class="form-group">
    <table class="table table-bordered table-condensed table-striped" id="sortable" style="max-width: 1000px">
        <thead>
        <th class="col-sm-1">#</th>
        <th class="col-sm-4">Название параметра</th>
        <th class="col-sm-4">Единицы измерения</th>
        <th class="col-sm-2 glyphicon glyphicon-edit"></th>
        <th class="col-sm-1 glyphicon glyphicon-trash"></th>
        </thead>
        <tbody></tbody>
    </table>
</div>
<div class="form-group">
    <a href="@Url.Action("Index","TableParameters")" id="nextStep" class="btn btn-default inactive pull-right">Далее</a>
</div>
<script type="text/html" id="parameterTmpl">
    <tr data-id="Id">
        <td class="index"></td>
        <td data-content="Name" data-name="ParameterName" class="editable parameterName"></td>
        <td data-content="Unit" data-name="ParameterUnit" class=" editable parameterUnit"></td>
        <td><a data-id="Id" class="action edit-action btn-link glyphicon glyphicon-edit"></a></td>
        <td><a data-id="Id" class="action remove-action btn-link glyphicon glyphicon-remove error"></a></td>
    </tr>
</script>
<script type="text/javascript">
    $(document).ready(function () {
        var container = $('#main');
        var sender = new egcad.Data.Sender();
        var $nextStep = $('#nextStep');

        container.find("#saveParameter").on("click", function () {

            var parameterName = container.find('#parameterName');
            var parameterUnit = container.find('#parameterUnit');

            if (!parameterName.val()) return;
            addHandler(parameterName.val(), parameterUnit.val());

            parameterName.val('');
            parameterUnit.val('');
        });

        var editor = new egcad.TableEditor($('table'),
                                            {
                                                rowTmplSelector:'#parameterTmpl',
                                                refreshUrl: '@Url.Action("GetState")',
                                                removeUrl: '@Url.Action("Remove")',
                                                saveUrl: '@Url.Action("Save")',
                                                isSortable: true,
                                                swapUrl: '@Url.Action("Swap")',
                                                onRefresh: validate
                                            });

        function addHandler(parameterName, parameterUnit) {
            sender.get("addParam", '@Url.Action("Add")', { name: parameterName, unit: parameterUnit }, function (response) {
                if (response && response.statusCode == 0) {
                    editor.refresh();
                }
            });
        }

        function validate() {
            if (editor.isEmpty) {
                $nextStep.addClass('btn-success').removeClass('inactive btn-default');
            } else {
                $nextStep.addClass('btn-default inactive').removeClass('btn-success');
            }
        }
    });

</script>
